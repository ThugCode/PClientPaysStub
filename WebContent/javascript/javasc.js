function getRequeteHttp() {	var requeteHttp;	if (window.XMLHttpRequest) {			// Mozilla		requeteHttp = new XMLHttpRequest();		if (requeteHttp.overrideMimeType) { 			// problème firefox			requeteHttp.overrideMimeType('text/xml');		}	} else if (window.ActiveXObject) {			// C'est Internet explorer < IE7		try {			requeteHttp = new ActiveXObject("Msxml2.XMLHTTP");		} catch(e) {			try {				requeteHttp = new ActiveXObject("Microsoft.XMLHTTP");			} catch(e) {				requeteHttp = null;			}		}	}	return requeteHttp;}function DemandeRecherche(recherche) {	var requeteHttp = getRequeteHttp();	if (requeteHttp == null) {		alert("Impossible d'utiliser Ajax sur ce navigateur");	} else {		requeteHttp.open('GET', 'Controleur?action=cherchePays&q=' + recherche, true);		requeteHttp.onreadystatechange = function() {			ReceptionRecherche(requeteHttp);		};		requeteHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");		requeteHttp.send(null);	}	return;}function ReceptionRecherche(requete) {	if (requete.readyState == 4) {		if (requete.status == 200) {			document.getElementById("results").innerHTML = requete.responseText;			//alert(requete.responseText);		} else {			alert("La requête ne s'est pas correctement exécutée");		}	}}function sens(action) {	tch = action.keyCode;	if(tch == '37')		return 'g';	else if(tch == '38')		return 'h';	else if(tch == '39')		return 'd';	else if(tch == '40')// || tch=='13') // 13 = \n		return 'b';	else		return '0';}//selectionner un élément de la listefunction selectionner(id) {	var i;	for(i = 1; i <= nb_resultats; i++) {		$('#results'+i).removeClass('selected');	}	$('#results'+id).addClass('selected');	$('#selectionne').val(id);}var nb_resultats = 0;$(document).ready( function() {	$(window).keydown(function(event){		if(event.keyCode == 13) {			event.preventDefault();			return false;		}	});		$('#q').focus();	// détection de la saisie dans le champ de recherche	$('#q').keyup( function(e){		$field = $('#q');		var se = sens(e);		if(se == 'b' || se == 'h') {			/* touche haut ou bas enfoncée */			//alert("nb_resultats : " + nb_resultats);			if(nb_resultats != 0) {				/* il y a des résultats ... */				var selection = $('#selectionne').val();				//alert('La selection est ' + selection + ' / ' + nb_resultats + '\nOn veut ' + se);				if(se == 'b' && selection < nb_resultats) {					/* on descend et c'est possible */					selection++;					selectionner(selection);				} else if(se == 'h' && selection > 1) {					 /* on monte et c'est possible */					selection--;					selectionner(selection);					$(this).setCursorPosition($(this).val().length);				}			}		} 				if($field.val().length > 0) {			// on envoie la valeur recherchée en GET au fichier de traitement			DemandeRecherche($field.val());			var data = 'q=' + $(this).val();			nb_resultats = data.nb;		} else {			$('#results').html(''); // on vide les resultats			$('#selectionne').val(0);		}	});});